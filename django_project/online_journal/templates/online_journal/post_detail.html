{% extends 'base.html' %}
{% load widget_tweaks %}

{% block title %}
    {{ post.title }}
{% endblock %}

{% block content %}
    <div class="jumbotron">
        <h2>{{post.title}}</h2>
        <p class="lead">{{post.text}}</p>
    </div>
    <div class="row mt-5">
        <div class="comment_label col-10">
            <h3>{{ post.get_comments_count }} comments</h3>
        </div>
        <div class="col-2">
            <form action="{% url 'like_post' pk=post.id %}" method="post">
                {% csrf_token %}
                <input type="submit"
                {% if already_liked_by_user %}
                    value="Liked" 
                    class="btn btn-danger"
                {% else %}
                    value="Like"
                    class="btn btn-outline-danger"
                {% endif %}
                > {{ post.likes_number }}
            </form>
        </div>
    </div>
    <hr>
    {% for comment in page_obj %}
        <div class="comment_block mt-4">
            <div class="date mb-2">
                {{ comment.pub_date }}
            </div>
            <div class="text">
                {{ comment.text }}
            </div>
        </div>
    {% empty %}
        <h6 class="empty-content">No comments</h6>
    {% endfor %}

    <div class="pagination mt-4">
        <span class="step-links">
            {% if page_obj.has_previous %}
                <a href="?page=1">&laquo; first</a>
                <a href="?page={{ page_obj.previous_page_number }}">previous</a>
            {% endif %}
    
            <span class="current">
                Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
            </span>
    
            {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}">next</a>
                <a href="?page={{ page_obj.paginator.num_pages }}">last &raquo;</a>
            {% endif %}
        </span>
    </div>

    <form action="{% url 'add_comment' pk=post.id %}" method="post">
        {% csrf_token %}
        <div class="comment-form-wrapper mt-4">
            <div id="comment-textarea">
                {% render_field form.text class='form-control' rows=3 %}
            </div>
            <div id="comment-submit">
                <input type="submit" value="Write comment" class="btn btn-primary">
            </div>
        </div>
    </form>
{% endblock %}